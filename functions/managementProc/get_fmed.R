



get_fmed <- function(parpop, rep_slp, ssbrGrid){
 
  # take the inverse of the slope to get the desired replacement-level
  # SSBR
  ssbr_star <- 1 / rep_slp

  # Find the SSBR from the SSBR matrix
  F_star_ind <- which.min(abs(ssbrGrid[,2] - ssbr_star))
  F_star <- ssbrGrid[F_star_ind,1]

  # Print a warning if outside the sampled range of SSBRs
  if(F_star_ind == 1 | F_star_ind == nrow(ssbrGrid)){
    print('WARNING: SSBR outside sample range')
  }
  
  return(list(RPvalue=F_star))

}



# # Testing
# parpop <- list(waa = c(6.162753e-05, 0.0004898678, 0.001349414, 0.002513996, 
#                        0.003828504, 0.005166565, 0.006442675, 0.007607385, 
#                        0.008637986, 0.00952959, 0.01028811, 0.01092526, 
#                        0.01145527, 0.01189286, 0.01225201),
#                
#                sel = c(0.02983366, 0.1207014, 0.3131968, 0.544452, 0.7214171, 
#                        0.8280724, 0.8879541, 0.9219868, 0.9421533, 0.9546855, 
#                        0.9628277, 0.9683261, 0.9721615, 0.9749097, 0.9769222),
#                
#                M = c(0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 
#                      0.1, 0.1, 0.1, 0.1),
#                
#                mat = c(0.0752212, 0.4687695, 0.8567003, 0.9652281, 0.9896026, 
#                        0.9961067, 0.9982356, 0.9990659, 0.9994395, 0.999628, 
#                        0.9997323, 0.9997945, 0.9998337, 0.9998597, 0.9998776),
#                
#                R = c(19547356, 35078206, 27233625, 26270398, 22641519, 22641519, 
#                      27410526, 25111002, 26008120, 33317613, 28620531, 26724153, 
#                      26796403, 23308918, 30168548, 35896693, 28693501, 22591918, 
#                      21674410, 29912927, 14576665, 11856781, 11856781, 15428706, 
#                      18380227, 14586580, 14586580, 8690952, 11337731, 7811950),
#                
#                SSB = c(381157.9, 364810.9, 343017.4, 348422.1, 362937.9, 375785.5, 
#                      394881.6, 400265.9, 402554.2, 408274.2, 406672.3, 424411.8, 
#                      432210.6, 441509.5, 448223.4, 453963.2, 457103.6, 469232.4, 
#                      474285.9, 473536.3, 460992.5, 461356.5, 448017.5, 428514.3, 
#                      392707.3, 358871, 336044.9, 313091.9, 297577.9, 275644.1))
# 
# rep_slp <- 55.526
# 
# ssbrGrid <- matrix(ncol=2, byrow=TRUE,
#                    data = c(0, 0.0408046460148756,
#                             0.02002002002002, 0.0369286016050999,
#                             0.04004004004004, 0.0335401728577561,
#                             0.0600600600600601, 0.0305703448868519,
#                             0.0800800800800801, 0.0279605387355555,
#                             0.1001001001001, 0.0256609649983016,
#                             0.12012012012012, 0.0236292449198913,
#                             0.14014014014014, 0.0218292545734883,
#                             0.16016016016016, 0.0202301552100523,
#                             0.18018018018018, 0.0188055790824005,
#                             0.2002002002002, 0.0175329451987146,
#                             0.22022022022022, 0.0163928837354138,
#                             0.24024024024024, 0.0153687513886647,
#                             0.26026026026026, 0.0144462228920237,
#                             0.28028028028028, 0.0136129463778031,
#                             0.3003003003003, 0.0128582522969278,
#                             0.32032032032032, 0.0121729073067773,
#                             0.34034034034034, 0.0115489059471163,
#                             0.36036036036036, 0.0109792940989862,
#                             0.38038038038038, 0.0104580192003613,
#                             0.4004004004004, 0.00997980300858644,
#                             0.42042042042042, 0.00954003338057298,
#                             0.44044044044044, 0.00913467211021,
#                             0.46046046046046, 0.00876017633732669,
#                             0.48048048048048, 0.00841343143950298,
#                             0.500500500500501, 0.00809169365007597,
#                             0.520520520520521, 0.00779254092364313,
#                             0.540540540540541, 0.00751383080320028,
#                             0.560560560560561, 0.00725366423824337,
#                             0.580580580580581, 0.00701035446691989,
#                             0.600600600600601, 0.00678240021280977,
#                             0.620620620620621, 0.00656846256245275,
#                             0.640640640640641, 0.00636734498690676,
#                             0.660660660660661, 0.00617797605241052,
#                             0.680680680680681, 0.00599939443412854,
#                             0.700700700700701, 0.00583073590505931,
#                             0.720720720720721, 0.00567122202122706,
#                             0.740740740740741, 0.00552015026570706,
#                             0.760760760760761, 0.00537688544906847,
#                             0.780780780780781, 0.00524085219347508,
#                             0.800800800800801, 0.00511152835281265,
#                             0.820820820820821, 0.00498843924252658,
#                             0.840840840840841, 0.00487115257095295,
#                             0.860860860860861, 0.00475927397931079,
#                             0.880880880880881, 0.0046524431106164,
#                             0.900900900900901, 0.00455033013893502,
#                             0.920920920920921, 0.00445263269989896,
#                             0.940940940940941, 0.00435907317154596,
#                             0.960960960960961, 0.00426939626147736,
#                             0.980980980980981, 0.00418336686228131,
#                             1.001001001001, 0.0041007681422623,
#                             1.02102102102102, 0.00402139984289038,
#                             1.04104104104104, 0.00394507675814096,
#                             1.06106106106106, 0.0038716273741278,
#                             1.08108108108108, 0.00380089265021606,
#                             1.1011011011011, 0.00373272492520369,
#                             1.12112112112112, 0.00366698693423319,
#                             1.14114114114114, 0.00360355092388977,
#                             1.16116116116116, 0.00354229785449477,
#                             1.18118118118118, 0.00348311667995013,
#                             1.2012012012012, 0.00342590369665945,
#                             1.22122122122122, 0.00337056195406751,
#                             1.24124124124124, 0.00331700072024597,
#                             1.26126126126126, 0.00326513499672453,
#                             1.28128128128128, 0.00321488507744095,
#                             1.3013013013013, 0.00316617614727227,
#                             1.32132132132132, 0.00311893791612576,
#                             1.34134134134134, 0.00307310428501982,
#                             1.36136136136136, 0.00302861304098244,
#                             1.38138138138138, 0.00298540557794336,
#                             1.4014014014014, 0.00294342664110367,
#                             1.42142142142142, 0.00290262409253671,
#                             1.44144144144144, 0.00286294869601372,
#                             1.46146146146146, 0.00282435391925825,
#                             1.48148148148148, 0.00278679575202071,
#                             1.5015015015015, 0.00275023253852959,
#                             1.52152152152152, 0.00271462482302319,
#                             1.54154154154154, 0.00267993520719591,
#                             1.56156156156156, 0.00264612821850928,
#                             1.58158158158158, 0.00261317018842163,
#                             1.6016016016016, 0.002581029139682,
#                             1.62162162162162, 0.00254967468191665,
#                             1.64164164164164, 0.00251907791480989,
#                             1.66166166166166, 0.00248921133824685,
#                             1.68168168168168, 0.00246004876884491,
#                             1.7017017017017, 0.0024315652623534,
#                             1.72172172172172, 0.0024037370414487,
#                             1.74174174174174, 0.00237654142849467,
#                             1.76176176176176, 0.00234995678287692,
#                             1.78178178178178, 0.00232396244255384,
#                             1.8018018018018, 0.00229853866949893,
#                             1.82182182182182, 0.00227366659873705,
#                             1.84184184184184, 0.0022493281907027,
#                             1.86186186186186, 0.00222550618667172,
#                             1.88188188188188, 0.00220218406703864,
#                             1.9019019019019, 0.00217934601223086,
#                             1.92192192192192, 0.00215697686606823,
#                             1.94194194194194, 0.00213506210139209,
#                             1.96196196196196, 0.00211358778780214,
#                             1.98198198198198, 0.00209254056135258))
# 
# 
# x <- get_fmed(parpop, rep_slp, ssbrGrid)
